(function(){var f=tinymce.each;tinymce.create('tinymce.plugins.ImagemapperPlugin',{init:function(c,d){var t=this;t.editor=c;c.addCommand('mceImagemapper',function(a){c.windowManager.open({file:d+'/imagemapper.htm',width:c.getParam('imagemapper_popup_width',750),height:c.getParam('imagemapper_popup_height',600),inline:1},{plugin_url:d})});c.addCommand('mceInsertImagemapper',t._insertImagemapper,t);c.addButton('imagemapper',{title:'imagemapper.desc',cmd:'mceImagemapper'});c.onPreProcess.add(function(a,o){var b=a.dom;f(b.select('div',o.node),function(e){if(b.hasClass(e,'mceTmpl')){f(b.select('*',e),function(e){if(b.hasClass(e,a.getParam('imagemapper_mdate_classes','mdate').replace(/\s+/g,'|')))e.innerHTML=t._getDateTime(new Date(),a.getParam("imagemapper_mdate_format",a.getLang("imagemapper.mdate_format")))});t._replaceVals(e)}})})},getInfo:function(){return{longname:'Imagemapper plugin',author:'Moxiecode Systems AB',authorurl:'http://www.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/imagemapper',version:tinymce.majorVersion+"."+tinymce.minorVersion}},_insertImagemapper:function(a,v){var t=this,ed=t.editor,h,el,dom=ed.dom,sel=ed.selection.getContent();h=v.content;f(t.editor.getParam('imagemapper_replace_values'),function(v,k){if(typeof(v)!='function')h=h.replace(new RegExp('\\{\\$'+k+'\\}','g'),v)});el=dom.create('div',null,h);n=dom.select('.mceTmpl',el);if(n&&n.length>0){el=dom.create('div',null);el.appendChild(n[0].cloneNode(true))}function hasClass(n,c){return new RegExp('\\b'+c+'\\b','g').test(n.className)};f(dom.select('*',el),function(n){if(hasClass(n,ed.getParam('imagemapper_cdate_classes','cdate').replace(/\s+/g,'|')))n.innerHTML=t._getDateTime(new Date(),ed.getParam("imagemapper_cdate_format",ed.getLang("imagemapper.cdate_format")));if(hasClass(n,ed.getParam('imagemapper_mdate_classes','mdate').replace(/\s+/g,'|')))n.innerHTML=t._getDateTime(new Date(),ed.getParam("imagemapper_mdate_format",ed.getLang("imagemapper.mdate_format")));if(hasClass(n,ed.getParam('imagemapper_selected_content_classes','selcontent').replace(/\s+/g,'|')))n.innerHTML=sel});t._replaceVals(el);ed.execCommand('mceInsertContent',false,el.innerHTML);ed.addVisual()},_replaceVals:function(e){var a=this.editor.dom,vl=this.editor.getParam('imagemapper_replace_values');f(a.select('*',e),function(e){f(vl,function(v,k){if(a.hasClass(e,k)){if(typeof(vl[k])=='function')vl[k](e)}})})},_getDateTime:function(d,c){if(!c)return"";function addZeros(a,b){var i;a=""+a;if(a.length<b){for(i=0;i<(b-a.length);i++)a="0"+a}return a}c=c.replace("%D","%m/%d/%y");c=c.replace("%r","%I:%M:%S %p");c=c.replace("%Y",""+d.getFullYear());c=c.replace("%y",""+d.getYear());c=c.replace("%m",addZeros(d.getMonth()+1,2));c=c.replace("%d",addZeros(d.getDate(),2));c=c.replace("%H",""+addZeros(d.getHours(),2));c=c.replace("%M",""+addZeros(d.getMinutes(),2));c=c.replace("%S",""+addZeros(d.getSeconds(),2));c=c.replace("%I",""+((d.getHours()+11)%12+1));c=c.replace("%p",""+(d.getHours()<12?"AM":"PM"));c=c.replace("%B",""+this.editor.getLang("imagemapper_months_long").split(',')[d.getMonth()]);c=c.replace("%b",""+this.editor.getLang("imagemapper_months_short").split(',')[d.getMonth()]);c=c.replace("%A",""+this.editor.getLang("imagemapper_day_long").split(',')[d.getDay()]);c=c.replace("%a",""+this.editor.getLang("imagemapper_day_short").split(',')[d.getDay()]);c=c.replace("%%","%");return c}});tinymce.PluginManager.add('imagemapper',tinymce.plugins.ImagemapperPlugin)})();